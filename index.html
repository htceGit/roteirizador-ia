<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leilão de Domínio Premium - Roteirizador.ia.br</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#0f172a',
                            primary: '#2563eb',
                            accent: '#00dc82', // Verde neon IA
                            danger: '#ef4444'
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-text {
            background: linear-gradient(to right, #3b82f6, #00dc82);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="bg-brand-dark text-white font-sans antialiased min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="border-b border-gray-800 bg-gray-900/50 backdrop-blur-md fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold tracking-tighter">
                        roteirizador<span class="text-brand-accent">.ia.br</span>
                    </span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#leilao" class="bg-brand-primary hover:bg-blue-600 px-4 py-2 rounded-md text-sm font-medium transition-colors">Dar Lance Agora</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <main class="flex-grow pt-24 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                
                <!-- Left Column: Value Prop -->
                <div>
                    <div class="inline-flex items-center px-3 py-1 rounded-full border border-brand-accent/30 bg-brand-accent/10 text-brand-accent text-sm font-semibold mb-6">
                        <i class="fas fa-gavel mr-2"></i> Leilão Oficial em Andamento
                    </div>
                    <h1 class="text-4xl md:text-6xl font-extrabold leading-tight mb-6">
                        O Domínio Definitivo para <br>
                        <span class="gradient-text">Logística & IA</span>
                    </h1>
                    <p class="text-gray-400 text-lg mb-8 leading-relaxed">
                        Garanta autoridade instantânea no mercado brasileiro de transportes. 
                        <strong>roteirizador.ia.br</strong> combina a palavra-chave mais buscada do setor com a extensão tecnológica do momento.
                    </p>
                    
                    <ul class="space-y-4 mb-8">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-brand-accent mt-1 mr-3"></i>
                            <div>
                                <strong class="block text-white">Autoridade SEO</strong>
                                <span class="text-gray-400 text-sm">Posicione-se organicamente para termos de alto custo por clique.</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-brand-accent mt-1 mr-3"></i>
                            <div>
                                <strong class="block text-white">Identidade Premium</strong>
                                <span class="text-gray-400 text-sm">Ideal para SaaS, Startups e Transportadoras inovadoras.</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-brand-accent mt-1 mr-3"></i>
                            <div>
                                <strong class="block text-white">Extensão .IA.BR</strong>
                                <span class="text-gray-400 text-sm">Demonstre inovação e foco em Inteligência Artificial.</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Right Column: Auction System -->
                <div id="leilao" class="glass-panel rounded-2xl p-6 md:p-8 shadow-2xl shadow-brand-primary/20 relative overflow-hidden">
                    <!-- Status Badge -->
                    <div class="absolute top-4 right-4">
                        <span id="status-badge" class="flex items-center px-3 py-1 rounded-full bg-red-500/20 text-red-400 text-xs font-bold border border-red-500/30 animate-pulse">
                            <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span> AO VIVO
                        </span>
                    </div>

                    <!-- Countdown Compacto com Barra de Progresso -->
                    <div class="mb-6 p-4 bg-gray-800/30 rounded-xl border border-gray-700/50 backdrop-blur-sm">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Tempo Restante</span>
                            <span class="text-[10px] text-brand-accent font-mono bg-brand-accent/10 px-2 py-0.5 rounded border border-brand-accent/20">
                                <i class="far fa-clock mr-1"></i>01 MAR '26 - 16h
                            </span>
                        </div>
                        
                        <div id="countdown" class="grid grid-cols-4 gap-2 text-center mb-4">
                            <!-- Compact units -->
                            <div class="bg-gray-900 rounded-lg p-2 border border-gray-700/50 flex flex-col justify-center">
                                <span class="block text-lg md:text-xl font-bold font-mono leading-none text-white" id="days">00</span>
                                <span class="text-[8px] text-gray-500 uppercase mt-1 tracking-wider">Dias</span>
                            </div>
                            <div class="bg-gray-900 rounded-lg p-2 border border-gray-700/50 flex flex-col justify-center">
                                <span class="block text-lg md:text-xl font-bold font-mono leading-none text-white" id="hours">00</span>
                                <span class="text-[8px] text-gray-500 uppercase mt-1 tracking-wider">Hrs</span>
                            </div>
                            <div class="bg-gray-900 rounded-lg p-2 border border-gray-700/50 flex flex-col justify-center">
                                <span class="block text-lg md:text-xl font-bold font-mono leading-none text-white" id="minutes">00</span>
                                <span class="text-[8px] text-gray-500 uppercase mt-1 tracking-wider">Min</span>
                            </div>
                            <div class="bg-gray-900 rounded-lg p-2 border border-gray-700/50 flex flex-col justify-center relative overflow-hidden">
                                <span class="block text-lg md:text-xl font-bold font-mono text-brand-accent leading-none relative z-10" id="seconds">00</span>
                                <span class="text-[8px] text-gray-500 uppercase mt-1 tracking-wider relative z-10">Seg</span>
                                <div class="absolute inset-0 bg-brand-accent/5 z-0"></div>
                            </div>
                        </div>

                        <!-- Progress Bar Container -->
                        <div class="relative pt-1">
                            <div class="flex mb-1 items-center justify-between text-[9px] text-gray-500 font-mono opacity-80">
                                <span>01 JAN</span>
                                <span class="text-right">01 MAR</span>
                            </div>
                            <div class="overflow-hidden h-1.5 mb-1 text-xs flex rounded-full bg-gray-900 border border-gray-700">
                                <div id="progress-bar" style="width:0%" class="shadow-[0_0_10px_rgba(37,99,235,0.5)] flex flex-col text-center whitespace-nowrap text-white justify-center bg-gradient-to-r from-brand-primary to-brand-accent transition-all duration-1000 ease-linear"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Current Highest Bid -->
                    <div class="bg-brand-primary/10 border border-brand-primary/30 rounded-xl p-4 text-center mb-6">
                        <p class="text-brand-primary text-sm font-bold uppercase">Lance Atual Mais Alto</p>
                        <h2 id="highest-bid-display" class="text-4xl font-bold text-white mt-1">R$ 0,00</h2>
                    </div>

                    <!-- Bidding Form -->
                    <form id="bid-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Seu Nome</label>
                            <input type="text" id="name" required class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-brand-primary focus:border-transparent outline-none transition" placeholder="Nome da Empresa ou Pessoa">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">E-mail Profissional</label>
                            <input type="email" id="email" required class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-brand-primary focus:border-transparent outline-none transition" placeholder="contato@empresa.com.br">
                            <p class="text-xs text-gray-500 mt-1">Necessário para validação do lance.</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-1">Valor do Lance (R$)</label>
                            <div class="relative">
                                <span class="absolute left-4 top-3 text-gray-400">R$</span>
                                <input type="number" id="amount" required step="50" min="500" class="w-full bg-gray-900 border border-gray-700 rounded-lg pl-10 pr-4 py-3 text-white focus:ring-2 focus:ring-brand-accent focus:border-transparent outline-none transition font-mono text-lg" placeholder="500.00">
                            </div>
                            <p id="min-bid-msg" class="text-xs text-gray-500 mt-1">Lance mínimo: R$ 500,00</p>
                        </div>

                        <button type="submit" id="submit-btn" class="w-full bg-gradient-to-r from-brand-primary to-blue-700 hover:from-blue-600 hover:to-blue-800 text-white font-bold py-4 rounded-lg shadow-lg transform transition hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed">
                            REGISTRAR LANCE OFICIAL
                        </button>
                    </form>

                    <!-- Feedback Messages -->
                    <div id="feedback" class="mt-4 text-center text-sm hidden"></div>
                </div>
            </div>

            <!-- Live Feed / Leaderboard -->
            <div class="mt-20 max-w-3xl mx-auto">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-list-ol text-brand-accent mr-3"></i> Top 5 Maiores Lances
                </h3>
                <div class="bg-gray-800/40 rounded-xl overflow-hidden border border-gray-700">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-900/50 text-gray-400 text-xs uppercase">
                                <tr>
                                    <th class="px-6 py-4">Usuário</th>
                                    <th class="px-6 py-4">Data</th>
                                    <th class="px-6 py-4 text-right">Valor</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body" class="divide-y divide-gray-700/50">
                                <!-- Lances serão inseridos aqui via JS -->
                                <tr>
                                    <td colspan="3" class="px-6 py-8 text-center text-gray-500 italic">
                                        Carregando lances...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <p class="text-center text-xs text-gray-500 mt-4">
                    * Os e-mails são protegidos e mascarados diretamente no servidor.
                </p>
            </div>
        </div>
    </main>

    <footer class="border-t border-gray-800 bg-gray-900 py-10">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm">
                &copy; 2025 Roteirizador.ia.br. Todos os direitos reservados.
            </p>
            <p class="text-gray-600 text-xs mt-2">
                Este site é uma plataforma de venda de domínio. O pagamento será intermediado por plataforma segura (Escrow) após o encerramento do leilão.
            </p>
        </div>
    </footer>

    <!-- Logic Script -->
    <script>
        // --- CONFIGURAÇÃO SUPABASE ---
        // IMPORTANTE: Substitua pelas suas chaves reais do Supabase
        const SUPABASE_URL = 'https://fipjivizuuuhlzpcewzw.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_2YSikUkRJnroTR1XKCMG1A_y574et2s';
        
        let supabaseClient;

        try {
            if(SUPABASE_URL === 'SUA_URL_SUPABASE_AQUI') {
                console.warn("Configure as chaves do Supabase no código HTML.");
            } else {
                if (window.supabase) {
                    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                } else {
                    console.error("Biblioteca Supabase não carregou corretamente.");
                }
            }
        } catch(e) {
            console.error("Erro ao iniciar Supabase", e);
        }

        // --- CONFIGURAÇÃO LEILÃO ---
        const auctionStartDate = new Date('January 01, 2026 00:00:00').getTime();
        const auctionEndDate = new Date('March 01, 2026 16:00:00').getTime(); 
        const MINIMUM_BID_START = 500;
        let currentMaxBid = 0;

        // Elementos DOM
        const form = document.getElementById('bid-form');
        const submitBtn = document.getElementById('submit-btn');
        const feedback = document.getElementById('feedback');
        const leaderboardBody = document.getElementById('leaderboard-body');
        const highestBidDisplay = document.getElementById('highest-bid-display');
        const minBidMsg = document.getElementById('min-bid-msg');
        const amountInput = document.getElementById('amount');
        const progressBar = document.getElementById('progress-bar');

        // --- FORMATADORES ---
        const currencyFormatter = new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL'
        });

        const dateFormatter = new Intl.DateTimeFormat('pt-BR', {
            day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'
        });

        // --- COUNTDOWN E PROGRESS BAR ---
        const countdownTimer = setInterval(function() {
            const now = new Date().getTime();
            const distance = auctionEndDate - now;
            const totalDuration = auctionEndDate - auctionStartDate;
            const elapsed = now - auctionStartDate;
            let percentage = (elapsed / totalDuration) * 100;
            
            percentage = Math.max(0, Math.min(100, percentage));
            if (progressBar) {
                progressBar.style.width = percentage + "%";
            }

            if (distance < 0) {
                clearInterval(countdownTimer);
                document.getElementById("status-badge").innerHTML = "ENCERRADO";
                document.getElementById("status-badge").className = "flex items-center px-3 py-1 rounded-full bg-gray-700 text-gray-300 text-xs font-bold border border-gray-600";
                form.innerHTML = '<div class="text-center p-6 bg-gray-800 rounded text-gray-300">O leilão foi encerrado.</div>';
                
                ['days', 'hours', 'minutes', 'seconds'].forEach(id => document.getElementById(id).innerText = "00");
                if (progressBar) progressBar.style.width = "100%";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("days").innerText = days < 10 ? "0" + days : days;
            document.getElementById("hours").innerText = hours < 10 ? "0" + hours : hours;
            document.getElementById("minutes").innerText = minutes < 10 ? "0" + minutes : minutes;
            document.getElementById("seconds").innerText = seconds < 10 ? "0" + seconds : seconds;
        }, 1000);

        // --- SUPABASE LOGIC (SECURE) ---

        async function fetchBids() {
            if (!supabaseClient) return;

            // Mudança: Chamada RPC em vez de select direto na tabela
            const { data, error } = await supabaseClient.rpc('get_leaderboard');

            if (error) {
                console.error('Erro ao buscar lances:', error);
                return;
            }

            updateUI(data);
        }

        function updateUI(bids) {
            leaderboardBody.innerHTML = '';
            
            if (!bids || bids.length === 0) {
                currentMaxBid = 0;
                highestBidDisplay.innerText = currencyFormatter.format(0);
                leaderboardBody.innerHTML = `<tr><td colspan="3" class="px-6 py-4 text-center text-gray-500">Nenhum lance registrado ainda. Seja o primeiro!</td></tr>`;
                minBidMsg.innerText = `Lance mínimo: ${currencyFormatter.format(MINIMUM_BID_START)}`;
                amountInput.min = MINIMUM_BID_START;
                return;
            }

            currentMaxBid = parseFloat(bids[0].amount);
            highestBidDisplay.innerText = currencyFormatter.format(currentMaxBid);
            
            const nextMinBid = currentMaxBid + 50;
            minBidMsg.innerText = `Lance mínimo atual: ${currencyFormatter.format(nextMinBid)}`;
            amountInput.min = nextMinBid;
            amountInput.placeholder = nextMinBid.toFixed(2);

            bids.forEach((bid, index) => {
                const rowClass = index === 0 ? "bg-brand-primary/10" : "";
                const trophy = index === 0 ? '<i class="fas fa-trophy text-yellow-400 mr-2"></i>' : '';
                
                // Nota: Agora usamos 'bid.masked_user' que vem do RPC, não mais bid.email
                const html = `
                    <tr class="${rowClass} hover:bg-white/5 transition">
                        <td class="px-6 py-4 font-medium text-gray-300">
                            ${trophy} ${bid.masked_user}
                        </td>
                        <td class="px-6 py-4 text-gray-400 text-sm">
                            ${dateFormatter.format(new Date(bid.created_at))}
                        </td>
                        <td class="px-6 py-4 text-right font-bold text-white font-mono">
                            ${currencyFormatter.format(bid.amount)}
                        </td>
                    </tr>
                `;
                leaderboardBody.innerHTML += html;
            });
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!supabaseClient) {
                alert("Configure o Supabase no código para funcionar.");
                return;
            }

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const minRequired = currentMaxBid > 0 ? currentMaxBid + 50 : MINIMUM_BID_START;

            if (amount < minRequired) {
                showFeedback(`O lance precisa ser maior que ${currencyFormatter.format(minRequired - 0.01)}`, 'error');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Processando...';

            const { data, error } = await supabaseClient
                .from('bids')
                .insert([{ name, email, amount }]);

            if (error) {
                showFeedback('Erro ao registrar lance: ' + error.message, 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'REGISTRAR LANCE OFICIAL';
            } else {
                showFeedback('Lance registrado com sucesso!', 'success');
                form.reset();
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'REGISTRAR LANCE OFICIAL';
                
                // Atualiza a lista imediatamente
                fetchBids(); 
            }
        });

        function showFeedback(msg, type) {
            feedback.innerText = msg;
            feedback.classList.remove('hidden', 'text-green-400', 'text-red-400');
            feedback.classList.add(type === 'success' ? 'text-green-400' : 'text-red-400');
            setTimeout(() => feedback.classList.add('hidden'), 5000);
        }

        // --- INIT ---
        if (supabaseClient) {
            fetchBids();
            
            // Auto-refresh (Polling) a cada 10 segundos
            // Necessário pois bloqueamos a leitura direta da tabela, 
            // o que pode impedir eventos Realtime dependendo da config.
            setInterval(fetchBids, 10000);
            
        } else {
            leaderboardBody.innerHTML = `
                <tr><td colspan="3" class="px-6 py-4 text-center text-yellow-500">
                    <i class="fas fa-exclamation-triangle"></i> Configure as chaves do Supabase no código (Linha 280)
                </td></tr>
            `;
        }
    </script>
</body>
</html>